<div class="ai-analyze-container">
  <!-- File Upload Section -->
  <div *ngIf="!analysisComplete" class="upload-section">
    <div class="upload-card">
      <div class="upload-header">
        <h2 *ngIf="!isTrialMode">Análise AI de Segurança</h2>
        <h2 *ngIf="isTrialMode">Teste Grátis - Análise AI</h2>
        <p *ngIf="isTrialMode" class="trial-notice">
          🎉 Teste grátis sem registo! Analisa 1 foto e vê o que o nosso AI detecta.
        </p>
      </div>

      <div class="upload-area" 
           (dragover)="$event.preventDefault()" 
           (drop)="onFileDrop($event)"
           [class.has-file]="selectedFile">
        
        <div *ngIf="!selectedFile" class="upload-placeholder">
          <div class="upload-icon">📸</div>
          <h3>Carregar Imagem</h3>
          <p>O nosso AI vai analisar automaticamente a segurança no trabalho</p>
          <input type="file" 
                 #fileInput 
                 (change)="onFileSelected($event)" 
                 accept="image/*" 
                 class="file-input">
          <button class="upload-btn" (click)="fileInput.click()">
            Escolher Ficheiro
          </button>
        </div>

        <div *ngIf="selectedFile" class="file-preview">
          <img [src]="imagePreview" alt="Preview" class="preview-image">
          <div class="file-info">
            <p class="file-name">{{ selectedFile.name }}</p>
            <p class="file-size">{{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB</p>
          </div>
          <button class="analyze-btn" (click)="startAnalysis()" [disabled]="isAnalyzing">
            <span *ngIf="!isAnalyzing">Analisar</span>
            <span *ngIf="isAnalyzing">⏳ A analisar...</span>
          </button>
        </div>
      </div>

      <!-- Error Display -->
      <div *ngIf="error" class="error-message">
        <p>❌ {{ error }}</p>
      </div>
    </div>
  </div>

  <!-- Analysis Results -->
  <div *ngIf="analysisComplete && analysisResult" class="results-section">
    <div class="results-card">
      <div class="results-header">
        <h2>🎯 Resultados da Análise AI</h2>
        <p>Análise completa da segurança no trabalho</p>
      </div>

      <!-- Image Preview -->
      <div *ngIf="imageUrl" class="image-preview">
        <img [src]="imageUrl" alt="Analyzed image" class="analyzed-image">
      </div>

      <!-- Compliance Score -->
      <div class="score-section">
        <div class="score-circle">
          <div class="score-number">{{ analysisResult.complianceScore }}%</div>
          <div class="score-label">Compliance</div>
        </div>
        <div class="score-details">
          <h3>Pontuação de Segurança</h3>
          <p>Baseado na análise AI da tua imagem</p>
        </div>
      </div>

      <!-- Violations -->
      <div class="violations-section">
        <h3>⚠️ Violações Identificadas</h3>
        <ul class="violations-list">
          <li *ngFor="let violation of analysisResult.violations">{{ violation }}</li>
        </ul>
      </div>

      <!-- Risks -->
      <div class="risks-section">
        <h3>💣 Riscos Identificados</h3>
        <ul class="risks-list">
          <li *ngFor="let risk of analysisResult.risks">{{ risk }}</li>
        </ul>
      </div>

      <!-- Recommendations -->
      <div class="recommendations-section">
        <h3>✅ Recomendações</h3>
        <ul class="recommendations-list">
          <li *ngFor="let rec of analysisResult.recommendations">{{ rec }}</li>
        </ul>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="download-btn" (click)="downloadPDF()">
          📄 Baixar PDF
        </button>
        
        <button *ngIf="!isTrialMode" class="dashboard-btn" (click)="goToDashboard()">
          📊 Ir para Dashboard
        </button>
        
        <button class="analyze-another-btn" (click)="analyzeAnother()">
          🔄 Analisar Outra Foto
        </button>
      </div>
    </div>

    <!-- Signup CTA for Trial Mode -->
    <div *ngIf="isTrialMode && showSignupCTA" class="signup-cta">
      <div class="cta-card">
        <div class="cta-header">
          <h2>🚀 Queres mais análises?</h2>
          <p>Desbloqueia o poder completo do nosso AI</p>
        </div>

        <div class="features-grid">
          <div class="feature">
            <span class="feature-icon">🧠</span>
            <h4>+20 Análises com IA</h4>
            <p>Análises ilimitadas com AI avançado</p>
          </div>
          <div class="feature">
            <span class="feature-icon">📸</span>
            <h4>Upload em Lote</h4>
            <p>Analisa múltiplas fotos de uma vez</p>
          </div>
          <div class="feature">
            <span class="feature-icon">📊</span>
            <h4>Dashboards Personalizados</h4>
            <p>Estatísticas por projeto e obra</p>
          </div>
          <div class="feature">
            <span class="feature-icon">📤</span>
            <h4>Relatórios Profissionais</h4>
            <p>Exportação PDF e envio automático</p>
          </div>
        </div>

        <div class="cta-buttons">
          <button class="signup-btn primary" (click)="goToSignup()">
            🎯 Criar Conta
          </button>
          <button class="pricing-btn secondary" (click)="goToPricing()">
            💰 Ver Preços
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF Report Element (hidden) -->
  <div id="analysis-report" style="display: none;">
    <h1>Relatório de Análise HSE AI</h1>
    <p><strong>Data:</strong> {{ currentDate | date:'dd/MM/yyyy HH:mm' }}</p>
    
    <div *ngIf="analysisResult">
      <h2>Pontuação de Compliance: {{ analysisResult.complianceScore }}%</h2>
      
      <h3>Violations Identificadas:</h3>
      <ul>
        <li *ngFor="let violation of analysisResult.violations">{{ violation }}</li>
      </ul>
      
      <h3>Riscos Identificados:</h3>
      <ul>
        <li *ngFor="let risk of analysisResult.risks">{{ risk }}</li>
      </ul>
      
      <h3>Recomendações:</h3>
      <ul>
        <li *ngFor="let rec of analysisResult.recommendations">{{ rec }}</li>
      </ul>
    </div>
  </div>
</div>
